# Logrotate configuration for Paperless-onS
# Install to: /etc/logrotate.d/paperless-ons

/var/log/paperless_ons/*.log {
    # Rotate logs daily
    daily

    # Keep 14 days of logs
    rotate 14

    # Compress old log files
    compress

    # Don't compress the most recent rotated file
    delaycompress

    # Don't error if log file is missing
    missingok

    # Don't rotate empty log files
    notifempty

    # Create new log file with these permissions
    create 0644 __USER__ __USER__

    # Use date as suffix for rotated files
    dateext
    dateformat -%Y%m%d

    # Post-rotation script - reload service to reopen log files
    postrotate
        if systemctl is-active --quiet paperless-ons; then
            systemctl reload paperless-ons > /dev/null 2>&1 || true
        fi
    endscript

    # Shared scripts - only run once for all logs
    sharedscripts

    # Maximum file size before rotation (in addition to daily)
    maxsize 100M
}

# Application-specific log files with different retention
/var/log/paperless_ons/error.log {
    daily
    rotate 30
    compress
    delaycompress
    missingok
    notifempty
    create 0644 __USER__ __USER__
    dateext
    dateformat -%Y%m%d
    maxsize 100M

    postrotate
        if systemctl is-active --quiet paperless-ons; then
            systemctl reload paperless-ons > /dev/null 2>&1 || true
        fi
    endscript

    sharedscripts
}
