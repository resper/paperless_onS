<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paperless-onS - Document Analyzer</title>
    <link href="/static/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <nav class="navbar navbar-dark bg-primary">
        <div class="container-fluid">
            <span class="navbar-brand mb-0 h1">üìÑ <span data-i18n="app.name">Paperless-onS</span></span>
            <span class="navbar-text text-white" data-i18n="app.description">AI-Powered Document Analysis</span>
            <div class="d-flex align-items-center">
                <button class="btn btn-outline-light btn-sm" id="languageToggle" onclick="toggleLanguage()">
                    <span id="currentLang">EN</span> üåê
                </button>
            </div>
        </div>
    </nav>

    <div class="container-fluid mt-4">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-md-3">
                <div class="card">
                    <div class="card-header bg-secondary text-white" data-i18n="navigation.title">
                        Navigation
                    </div>
                    <div class="list-group list-group-flush">
                        <a href="#" class="list-group-item list-group-item-action active" onclick="showTab('documents')" data-i18n="navigation.documents">
                            Documents
                        </a>
                        <a href="#" class="list-group-item list-group-item-action" onclick="showTab('settings')" data-i18n="navigation.settings">
                            Settings
                        </a>
                        <a href="#" class="list-group-item list-group-item-action" onclick="showTab('history')" data-i18n="navigation.history">
                            Processing History
                        </a>
                    </div>
                </div>
            </div>

            <!-- Main Content -->
            <div class="col-md-9">
                <!-- Documents Tab -->
                <div id="documentsTab" class="content-tab">
                    <div class="card">
                        <div class="card-header bg-primary text-white">
                            <h5 class="mb-0" data-i18n="documents.title">Documents</h5>
                        </div>
                        <div class="card-body">
                            <!-- Document Filters -->
                            <div class="card bg-light mb-3">
                                <div class="card-body">
                                    <h6 class="card-title" data-i18n="documents.filters">Filter</h6>
                                    <div class="row g-3">
                                        <!-- Tags Filter -->
                                        <div class="col-md-3">
                                            <label for="filterDocumentTags" class="form-label" data-i18n="documents.filter_by_tag">Nach Tag filtern</label>
                                            <select class="form-select form-select-sm" id="filterDocumentTags" multiple size="4">
                                                <option value="" data-i18n="documents.all_tags">Alle Tags</option>
                                                <!-- Tags will be loaded dynamically -->
                                            </select>
                                        </div>

                                        <!-- Correspondent Filter -->
                                        <div class="col-md-3">
                                            <label for="filterCorrespondent" class="form-label" data-i18n="documents.filter_by_correspondent">Nach Absender filtern</label>
                                            <select class="form-select form-select-sm" id="filterCorrespondent">
                                                <option value="" data-i18n="documents.all_correspondents">Alle Absender</option>
                                                <!-- Correspondents will be loaded dynamically -->
                                            </select>
                                        </div>

                                        <!-- Document Type Filter -->
                                        <div class="col-md-3">
                                            <label for="filterDocumentType" class="form-label" data-i18n="documents.filter_by_document_type">Nach Dokumententyp filtern</label>
                                            <select class="form-select form-select-sm" id="filterDocumentType">
                                                <option value="" data-i18n="documents.all_document_types">Alle Dokumententypen</option>
                                                <!-- Document types will be loaded dynamically -->
                                            </select>
                                        </div>

                                        <!-- Storage Path Filter -->
                                        <div class="col-md-3">
                                            <label for="filterStoragePath" class="form-label" data-i18n="documents.filter_by_storage_path">Nach Speicherort filtern</label>
                                            <select class="form-select form-select-sm" id="filterStoragePath">
                                                <option value="" data-i18n="documents.all_storage_paths">Alle Speicherorte</option>
                                                <!-- Storage paths will be loaded dynamically -->
                                            </select>
                                        </div>

                                        <!-- Date Filter -->
                                        <div class="col-md-3">
                                            <label class="form-label" data-i18n="documents.filter_by_date">Nach Datum filtern</label>
                                            <div class="mb-2">
                                                <input type="date" class="form-control form-control-sm" id="filterDateFrom" data-i18n-placeholder="documents.date_from" placeholder="Von Datum">
                                            </div>
                                            <input type="date" class="form-control form-control-sm" id="filterDateTo" data-i18n-placeholder="documents.date_to" placeholder="Bis Datum">
                                        </div>
                                    </div>

                                    <!-- Filter Buttons -->
                                    <div class="mt-3">
                                        <button type="button" class="btn btn-primary btn-sm" onclick="applyDocumentFilters()" data-i18n="documents.apply_filters">
                                            Filter anwenden
                                        </button>
                                        <button type="button" class="btn btn-secondary btn-sm ms-2" onclick="clearDocumentFilters()" data-i18n="documents.clear_filters">
                                            Filter zur√ºcksetzen
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- ID Sort Toggle Button and Document Limit -->
                            <div class="d-flex align-items-center justify-content-between mb-2">
                                <div class="d-flex align-items-center">
                                    <div class="form-check me-3">
                                        <input class="form-check-input" type="checkbox" id="selectAllDocuments" onchange="toggleSelectAll()" data-i18n-title="documents.select_all" title="Alle ausw√§hlen">
                                    </div>
                                    <button type="button" class="btn btn-sm btn-outline-secondary me-2" id="sortToggleBtn" onclick="toggleIdSort()" data-i18n-title="documents.sort_by_id" title="Nach ID sortieren">
                                        <span id="sortIcon">‚¨áÔ∏è</span>
                                    </button>
                                    <h6 class="mb-0 text-muted" id="documentCount"></h6>
                                    <button type="button" class="btn btn-sm btn-success ms-3" id="bulkProcessBtn" onclick="startBulkProcessing()" style="display: none;">
                                        <span data-i18n="documents.bulk_process">Ausgew√§hlte analysieren</span> (<span id="selectedCount">0</span>)
                                    </button>
                                </div>
                                <div class="d-flex align-items-center">
                                    <label for="documentLimit" class="form-label mb-0 me-2 text-muted small" data-i18n="documents.show_limit">Anzeigen:</label>
                                    <select class="form-select form-select-sm" id="documentLimit" onchange="changeDocumentLimit()" style="width: auto;">
                                        <option value="25">25</option>
                                        <option value="50" selected>50</option>
                                        <option value="100">100</option>
                                        <option value="all" data-i18n="documents.show_all">Alle</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Documents Loading/Content -->
                            <div id="documentsLoading" class="text-center" style="display: none;">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden" data-i18n="common.loading">Loading...</span>
                                </div>
                            </div>
                            <div id="documentsContent">
                                <p class="text-muted" data-i18n="documents.select_tag_prompt">Select a tag to view documents</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Settings Tab -->
                <div id="settingsTab" class="content-tab" style="display: none;">
                    <!-- Settings Sub-Tabs -->
                    <ul class="nav nav-tabs" id="settingsSubTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="api-tab" data-bs-toggle="tab" data-bs-target="#apiConfig" type="button" role="tab" aria-controls="apiConfig" aria-selected="true" data-i18n="settings.title">
                                API Configuration
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="processing-tab" data-bs-toggle="tab" data-bs-target="#processingConfig" type="button" role="tab" aria-controls="processingConfig" aria-selected="false" data-i18n="processing_settings.title">
                                Document Processing
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="auto-processing-tab" data-bs-toggle="tab" data-bs-target="#autoProcessingConfig" type="button" role="tab" aria-controls="autoProcessingConfig" aria-selected="false" data-i18n="auto_processing.title">
                                Automatic Processing
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="prompt-tab" data-bs-toggle="tab" data-bs-target="#promptConfig" type="button" role="tab" aria-controls="promptConfig" aria-selected="false" data-i18n="prompt.title">
                                Prompt Configuration
                            </button>
                        </li>
                    </ul>

                    <div class="tab-content" id="settingsSubTabsContent">
                        <!-- API Configuration Tab -->
                        <div class="tab-pane fade show active" id="apiConfig" role="tabpanel" aria-labelledby="api-tab">
                            <div class="card border-top-0 rounded-top-0">
                                <div class="card-body">
                                    <form id="settingsForm">
                                        <div class="mb-3">
                                            <label for="paperlessUrl" class="form-label" data-i18n="settings.paperless_url">Paperless-NGX URL</label>
                                            <input type="text" class="form-control" id="paperlessUrl"
                                                   placeholder="http://localhost:8000">
                                            <div class="form-text" data-i18n="settings.paperless_url_help">URL of your Paperless-NGX instance</div>
                                        </div>
                                        <div class="mb-3">
                                            <label for="paperlessToken" class="form-label" data-i18n="settings.paperless_token">Paperless API Token</label>
                                            <div class="input-group">
                                                <input type="password" class="form-control" id="paperlessToken"
                                                       data-i18n-placeholder="settings.paperless_token_placeholder"
                                                       placeholder="Enter your Paperless token">
                                                <button class="btn btn-outline-secondary" type="button" id="editPaperlessTokenBtn" onclick="toggleTokenEdit('paperlessToken')" data-i18n="settings.edit_token" title="Token bearbeiten">
                                                    üîì
                                                </button>
                                            </div>
                                            <div class="form-text" data-i18n="settings.paperless_token_help">Authentication token from Paperless-NGX</div>
                                        </div>
                                        <div class="mb-3">
                                            <label for="openaiKey" class="form-label" data-i18n="settings.openai_api_key">OpenAI API Key</label>
                                            <div class="input-group">
                                                <input type="password" class="form-control" id="openaiKey"
                                                       placeholder="sk-...">
                                                <button class="btn btn-outline-secondary" type="button" id="editOpenaiKeyBtn" onclick="toggleTokenEdit('openaiKey')" data-i18n="settings.edit_token" title="Schl√ºssel bearbeiten">
                                                    üîì
                                                </button>
                                            </div>
                                            <div class="form-text" data-i18n="settings.openai_api_key_help">Your OpenAI API key</div>
                                        </div>
                                        <div class="mb-3">
                                            <label for="openaiModel" class="form-label" data-i18n="settings.openai_model">OpenAI Model</label>
                                            <select class="form-select" id="openaiModel">
                                                <option value="gpt-4-turbo-preview">GPT-4 Turbo</option>
                                                <option value="gpt-3.5-turbo">GPT-3.5 Turbo</option>
                                            </select>
                                        </div>
                                        <div class="mb-3">
                                            <label for="maxTextLength" class="form-label" data-i18n="settings.max_text_length">Maximum Text Length</label>
                                            <input type="number" class="form-control" id="maxTextLength"
                                                   placeholder="10000" min="1000" max="50000" step="1000">
                                            <div class="form-text" data-i18n="settings.max_text_length_help">Maximum number of characters to extract from documents for analysis (1,000 - 50,000)</div>
                                        </div>
                                        <button type="submit" class="btn btn-primary" data-i18n="settings.save_settings">Save Settings</button>
                                        <button type="button" class="btn btn-secondary" onclick="testConnections()" data-i18n="settings.test_connections">Test Connections</button>
                                    </form>
                                </div>
                            </div>
                        </div>

                        <!-- Document Processing Tab -->
                        <div class="tab-pane fade" id="processingConfig" role="tabpanel" aria-labelledby="processing-tab">
                            <div class="card border-top-0 rounded-top-0">
                                <div class="card-body">
                                    <form id="processingSettingsForm">
                                        <!-- Text Preview Limit -->
                                        <div class="mb-4">
                                            <label for="displayTextLength" class="form-label" data-i18n="processing_settings.display_text_length">Text Preview Limit</label>
                                            <input type="number" class="form-control" id="displayTextLength"
                                                   placeholder="5000" min="500" max="20000" step="500">
                                            <div class="form-text" data-i18n="processing_settings.display_text_length_help">Maximum number of characters for text preview in analysis dialog (500 - 20,000)</div>
                                        </div>

                                        <hr>

                                        <!-- Auto Update Metadata -->
                                        <h6 class="mb-3" data-i18n="processing_settings.auto_update_title">Automatic Updates</h6>
                                        <div class="mb-4">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="autoUpdateMetadata">
                                                <label class="form-check-label" for="autoUpdateMetadata" data-i18n="processing_settings.auto_update">
                                                    Automatically update metadata (no confirmation)
                                                </label>
                                            </div>
                                            <div class="form-text" data-i18n="processing_settings.auto_update_help">
                                                If enabled, metadata will be applied directly without confirmation dialog.
                                            </div>
                                        </div>

                                        <button type="submit" class="btn btn-primary" data-i18n="processing_settings.save">Save Processing Settings</button>
                                    </form>
                                </div>
                            </div>
                        </div>

                        <!-- Automatic Processing Tab -->
                        <div class="tab-pane fade" id="autoProcessingConfig" role="tabpanel" aria-labelledby="auto-processing-tab">
                            <div class="card border-top-0 rounded-top-0">
                                <div class="card-body">
                                    <form id="autoProcessingSettingsForm">
                                        <!-- Info Box -->
                                        <div class="alert alert-info mb-4">
                                            <h6 class="alert-heading" data-i18n="auto_processing.info_title">About Automatic Processing</h6>
                                            <p class="mb-0 small" data-i18n="auto_processing.info_text">
                                                Configure automatic document processing. Documents with the selected filter tag will be automatically analyzed and updated. This feature will be implemented in a future update.
                                            </p>
                                        </div>

                                        <!-- Enable Auto Processing -->
                                        <div class="mb-4">
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" id="enableAutoProcessing">
                                                <label class="form-check-label" for="enableAutoProcessing" data-i18n="auto_processing.enable">
                                                    Enable Automatic Processing
                                                </label>
                                            </div>
                                            <div class="form-text" data-i18n="auto_processing.enable_help">
                                                When enabled, documents with the filter tag will be automatically processed
                                            </div>
                                        </div>

                                        <!-- Filter Tag Selection -->
                                        <div class="mb-4">
                                            <label for="autoProcessingFilterTag" class="form-label" data-i18n="auto_processing.filter_tag">
                                                Filter Tag for Automatic Processing
                                            </label>
                                            <div class="input-group">
                                                <select class="form-select" id="autoProcessingFilterTag">
                                                    <option value="" data-i18n="auto_processing.select_filter_tag">Select a filter tag...</option>
                                                    <!-- Tags will be loaded dynamically -->
                                                </select>
                                                <button class="btn btn-outline-secondary" type="button" onclick="loadAutoProcessingTags()" data-i18n="auto_processing.refresh_tags">
                                                    üîÑ Refresh
                                                </button>
                                            </div>
                                            <div class="form-text" data-i18n="auto_processing.filter_tag_help">
                                                Documents with this tag will be automatically processed
                                            </div>
                                        </div>

                                        <!-- Text Source Selection -->
                                        <div class="mb-4">
                                            <label class="form-label" data-i18n="auto_processing.text_source">Text Source for Automatic Processing</label>
                                            <div class="form-check">
                                                <input class="form-check-input" type="radio" name="autoTextSourceMode" id="autoTextSourcePaperless" value="paperless" checked>
                                                <label class="form-check-label" for="autoTextSourcePaperless" data-i18n="auto_processing.text_source_paperless">
                                                    Use text from Paperless-NGX
                                                </label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="radio" name="autoTextSourceMode" id="autoTextSourceSmart" value="smart">
                                                <label class="form-check-label" for="autoTextSourceSmart" data-i18n="auto_processing.text_source_smart">
                                                    Extract text from PDF, use Vision API for images
                                                </label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="radio" name="autoTextSourceMode" id="autoTextSourceVision" value="vision">
                                                <label class="form-check-label" for="autoTextSourceVision" data-i18n="auto_processing.text_source_vision">
                                                    Always send PDF to Vision API
                                                </label>
                                            </div>
                                            <div class="form-text" data-i18n="auto_processing.text_source_help">Choose how text should be extracted for AI analysis.</div>
                                        </div>

                                        <hr>

                                        <!-- Tag Management After Processing -->
                                        <h6 class="mb-3" data-i18n="auto_processing.tag_management">Tag Management After Processing</h6>

                                        <!-- Remove Filter Tag -->
                                        <div class="mb-4">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="removeFilterTagAfterProcessing">
                                                <label class="form-check-label" for="removeFilterTagAfterProcessing" data-i18n="auto_processing.remove_filter_tag">
                                                    Remove filter tag after successful processing
                                                </label>
                                            </div>
                                            <div class="form-text" data-i18n="auto_processing.remove_filter_tag_help">
                                                Automatically remove the filter tag from documents after they have been successfully processed
                                            </div>
                                        </div>

                                        <!-- Add Tag After Processing -->
                                        <div class="mb-4">
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="addTagAfterProcessing">
                                                <label class="form-check-label" for="addTagAfterProcessing" data-i18n="auto_processing.add_tag">
                                                    Add tag after successful processing
                                                </label>
                                            </div>
                                            <select class="form-select" id="addTagAfterProcessingSelect">
                                                <option value="" data-i18n="auto_processing.select_tag_to_add">Select tag to add...</option>
                                                <!-- Tags will be loaded dynamically -->
                                            </select>
                                            <div class="form-text" data-i18n="auto_processing.add_tag_help">
                                                Automatically add a specific tag to documents after successful processing
                                            </div>
                                        </div>

                                        <button type="submit" class="btn btn-primary" data-i18n="auto_processing.save">
                                            Save Automatic Processing Settings
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>

                        <!-- Prompt Configuration Tab -->
                        <div class="tab-pane fade" id="promptConfig" role="tabpanel" aria-labelledby="prompt-tab">
                            <div class="card border-top-0 rounded-top-0">
                                <div class="card-body">
                                    <!-- Modular Prompts Form -->
                                    <div id="modularPromptForm">
                                        <h6 class="mb-3" data-i18n="prompt.modular_title">Modular Prompt Configuration</h6>
                                        <p class="text-muted small" data-i18n="prompt.modular_help">Define specific instructions for each metadata field. The AI will return structured JSON responses.</p>

                                        <!-- Configuration Management -->
                                        <div class="card bg-light mb-4">
                                            <div class="card-body">
                                                <h6 class="card-title" data-i18n="prompt.configurations">Saved Configurations</h6>
                                                <div class="row g-2">
                                                    <div class="col-md-6">
                                                        <select class="form-select" id="configurationSelect">
                                                            <option value="" data-i18n="prompt.select_configuration">Select a configuration...</option>
                                                        </select>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <button type="button" class="btn btn-sm btn-outline-primary" onclick="loadSelectedConfiguration()" data-i18n="prompt.load_configuration">
                                                            üìÇ Load Configuration
                                                        </button>
                                                    </div>
                                                </div>
                                                <div class="mt-3">
                                                    <button type="button" class="btn btn-sm btn-success" onclick="showSaveConfigDialog()" data-i18n="prompt.save_as_new">
                                                        üíæ Save as New Configuration
                                                    </button>
                                                    <button type="button" class="btn btn-sm btn-primary ms-1" onclick="updateSelectedConfiguration()" data-i18n="prompt.update_current">
                                                        üîÑ Update Current Configuration
                                                    </button>
                                                    <button type="button" class="btn btn-sm btn-danger ms-1" onclick="deleteSelectedConfiguration()" data-i18n="prompt.delete_configuration">
                                                        üóëÔ∏è Delete Configuration
                                                    </button>
                                                </div>
                                            </div>
                                        </div>

                                        <form id="modularPromptsForm">
                                            <!-- Document Date -->
                                            <div class="mb-3">
                                                <label for="promptDocumentDate" class="form-label">
                                                    <span data-i18n="prompt.field_document_date">Document Date</span>
                                                </label>
                                                <textarea class="form-control font-monospace" id="promptDocumentDate" rows="3"></textarea>
                                            </div>

                                            <!-- Correspondent -->
                                            <div class="mb-3">
                                                <label for="promptCorrespondent" class="form-label">
                                                    <span data-i18n="prompt.field_correspondent">Correspondent</span>
                                                </label>
                                                <textarea class="form-control font-monospace" id="promptCorrespondent" rows="3"></textarea>
                                            </div>

                                            <!-- Document Type -->
                                            <div class="mb-3">
                                                <label for="promptDocumentType" class="form-label">
                                                    <span data-i18n="prompt.field_document_type">Document Type</span>
                                                </label>
                                                <textarea class="form-control font-monospace" id="promptDocumentType" rows="3"></textarea>
                                            </div>

                                            <!-- Storage Path -->
                                            <div class="mb-3">
                                                <label for="promptStoragePath" class="form-label">
                                                    <span data-i18n="prompt.field_storage_path">Storage Path</span>
                                                </label>
                                                <textarea class="form-control font-monospace" id="promptStoragePath" rows="3"></textarea>
                                            </div>

                                            <!-- Content Keywords -->
                                            <div class="mb-3">
                                                <label for="promptContentKeywords" class="form-label">
                                                    <span data-i18n="prompt.field_content_keywords">Content Keywords</span>
                                                </label>
                                                <textarea class="form-control font-monospace" id="promptContentKeywords" rows="3"></textarea>
                                            </div>

                                            <!-- Suggested Title -->
                                            <div class="mb-3">
                                                <label for="promptSuggestedTitle" class="form-label">
                                                    <span data-i18n="prompt.field_suggested_title">Suggested Title</span>
                                                </label>
                                                <textarea class="form-control font-monospace" id="promptSuggestedTitle" rows="3"></textarea>
                                            </div>

                                            <!-- Suggested Tag -->
                                            <div class="mb-3">
                                                <label for="promptSuggestedTag" class="form-label">
                                                    <span data-i18n="prompt.field_suggested_tag">Suggested Tag</span>
                                                </label>
                                                <textarea class="form-control font-monospace" id="promptSuggestedTag" rows="3"></textarea>
                                            </div>

                                            <hr>

                                            <!-- Free Instructions -->
                                            <div class="mb-3">
                                                <label for="promptFreeInstructions" class="form-label">
                                                    <span data-i18n="prompt.field_free_instructions">General Instructions</span>
                                                </label>
                                                <textarea class="form-control font-monospace" id="promptFreeInstructions" rows="2"></textarea>
                                                <div class="form-text" data-i18n="prompt.free_instructions_help">Additional instructions that apply to all fields (e.g., language preferences, formatting rules).</div>
                                            </div>

                                            <div class="mb-3">
                                                <button type="button" class="btn btn-sm btn-outline-secondary" onclick="loadDefaultModularPrompts()" data-i18n="prompt.load_defaults">
                                                    üîÑ Load Default Instructions
                                                </button>
                                                <button type="button" class="btn btn-sm btn-outline-info ms-2" onclick="showPlaceholders()" data-i18n="prompt.show_placeholders">
                                                    üìã Show Available Placeholders
                                                </button>
                                                <button type="button" class="btn btn-sm btn-outline-primary ms-2" onclick="showPromptTestDialog()" data-i18n="prompt.test_prompt">
                                                    üß™ Test with Document
                                                </button>
                                            </div>

                                            <button type="submit" class="btn btn-primary" data-i18n="prompt.save_prompt">üíæ Save Prompt</button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- History Tab -->
                <div id="historyTab" class="content-tab" style="display: none;">
                    <div class="card">
                        <div class="card-header bg-primary text-white">
                            <h5 class="mb-0" data-i18n="history.title">Processing History</h5>
                        </div>
                        <div class="card-body">
                            <div id="historyContent">
                                <p class="text-muted" data-i18n="common.loading">Loading history...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Processing Modal -->
    <div class="modal fade" id="processingModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" data-i18n="processing.title">Document Analysis Results</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="processingModalBody">
                    <div class="text-center">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden" data-i18n="common.loading">Processing...</span>
                        </div>
                        <p class="mt-2" data-i18n="processing.analyzing">Analyzing document...</p>
                    </div>
                </div>
                <div class="modal-footer" id="processingModalFooter">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-i18n="common.close">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Placeholders Modal -->
    <div class="modal fade" id="placeholdersModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" data-i18n="prompt.placeholders">Available Placeholders</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="placeholdersModalBody">
                    <p class="text-muted" data-i18n="common.loading">Loading...</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-i18n="common.close">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Document ID Input Modal -->
    <div class="modal fade" id="documentIdModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" data-i18n="prompt.test_prompt_title">Test Prompt with Document</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <label for="testDocumentIdInput" class="form-label" data-i18n="prompt.test_document_id">Enter Document ID to test:</label>
                    <input type="number" class="form-control" id="testDocumentIdInput" placeholder="123" min="1" onkeypress="if(event.key === 'Enter') runPromptTest()">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-i18n="common.cancel">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="runPromptTest()" data-i18n="prompt.run_test">Run Test</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Prompt Test Results Modal -->
    <div class="modal fade" id="promptTestModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" data-i18n="prompt.test_prompt_title">Test Prompt with Document</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="promptTestModalBody">
                    <p class="text-muted" data-i18n="common.loading">Loading...</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-i18n="common.close">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Save Configuration Modal -->
    <div class="modal fade" id="saveConfigModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" data-i18n="prompt.save_as_new">Save as New Configuration</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <label for="configNameInput" class="form-label" data-i18n="prompt.configuration_name">Configuration Name</label>
                    <input type="text" class="form-control" id="configNameInput" data-i18n-placeholder="prompt.enter_name" placeholder="Enter configuration name" onkeypress="if(event.key === 'Enter') saveNewConfiguration()">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-i18n="common.cancel">Cancel</button>
                    <button type="button" class="btn btn-success" onclick="saveNewConfiguration()" data-i18n="prompt.save_config">Save</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bulk Processing Configuration Modal -->
    <div class="modal fade" id="bulkProcessingConfigModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" data-i18n="documents.bulk_config_title">Bulk Processing Configuration</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p class="text-muted small" data-i18n="documents.bulk_config_help">
                        Select which metadata fields should be updated for the selected documents.
                    </p>

                    <h6 class="mb-3" data-i18n="documents.select_fields_to_update">Select fields to update:</h6>

                    <div class="form-check mb-2">
                        <input class="form-check-input" type="checkbox" id="bulkUpdateTitle" checked>
                        <label class="form-check-label" for="bulkUpdateTitle" data-i18n="processing.suggested_title">
                            Title
                        </label>
                    </div>

                    <div class="form-check mb-2">
                        <input class="form-check-input" type="checkbox" id="bulkUpdateDate" checked>
                        <label class="form-check-label" for="bulkUpdateDate" data-i18n="processing.document_date">
                            Document Date
                        </label>
                    </div>

                    <div class="form-check mb-2">
                        <input class="form-check-input" type="checkbox" id="bulkUpdateCorrespondent" checked>
                        <label class="form-check-label" for="bulkUpdateCorrespondent" data-i18n="processing.correspondent">
                            Correspondent
                        </label>
                    </div>

                    <div class="form-check mb-2">
                        <input class="form-check-input" type="checkbox" id="bulkUpdateDocumentType" checked>
                        <label class="form-check-label" for="bulkUpdateDocumentType" data-i18n="processing.document_type">
                            Document Type
                        </label>
                    </div>

                    <div class="form-check mb-2">
                        <input class="form-check-input" type="checkbox" id="bulkUpdateStoragePath" checked>
                        <label class="form-check-label" for="bulkUpdateStoragePath" data-i18n="processing.storage_path">
                            Storage Path
                        </label>
                    </div>

                    <div class="form-check mb-2">
                        <input class="form-check-input" type="checkbox" id="bulkUpdateKeywords" checked>
                        <label class="form-check-label" for="bulkUpdateKeywords" data-i18n="processing.content_keywords">
                            Content Keywords
                        </label>
                    </div>

                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="bulkUpdateTags" checked>
                        <label class="form-check-label" for="bulkUpdateTags" data-i18n="processing.suggested_tags">
                            Tags
                        </label>
                    </div>

                    <hr>

                    <h6 class="mb-3" data-i18n="documents.tag_options">Tag Options:</h6>

                    <div class="form-check mb-2">
                        <input class="form-check-input" type="checkbox" id="bulkClearExistingTags">
                        <label class="form-check-label" for="bulkClearExistingTags" data-i18n="processing.clear_existing_tags">
                            Clear existing tags
                        </label>
                    </div>
                    <small class="form-text text-muted d-block mb-3" data-i18n="processing.clear_existing_tags_help">
                        If enabled, all existing document tags will be removed before adding the new tags
                    </small>

                    <div class="form-check mb-2">
                        <input class="form-check-input" type="checkbox" id="bulkAddProcessingTag">
                        <label class="form-check-label" for="bulkAddProcessingTag" data-i18n="documents.add_bulk_tag">
                            Add tag to mark bulk processed documents
                        </label>
                    </div>
                    <select class="form-select form-select-sm mt-2" id="bulkProcessingTagSelect" disabled>
                        <option value="" data-i18n="documents.select_tag">Select a tag...</option>
                        <!-- Tags will be loaded dynamically -->
                    </select>
                    <small class="form-text text-muted d-block mt-1" data-i18n="documents.bulk_tag_help">
                        This tag will be added to all processed documents for identification
                    </small>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-i18n="common.cancel">Cancel</button>
                    <button type="button" class="btn btn-success" onclick="confirmBulkProcessing()" data-i18n="documents.start_processing">Start Processing</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Text Source Selection Modal -->
    <div class="modal fade" id="textSourceModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" data-i18n="text_source.modal_title">Select Text Source</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p class="text-muted mb-3" data-i18n="text_source.modal_subtitle">How should the text be extracted for AI analysis?</p>

                    <div class="form-check mb-3">
                        <input class="form-check-input" type="radio" name="textSourceOption" id="textSourceOptionPaperless" value="paperless" checked>
                        <label class="form-check-label" for="textSourceOptionPaperless">
                            <strong data-i18n="text_source.option_paperless">Use text from Paperless-NGX</strong>
                            <br>
                            <small class="text-muted" data-i18n="text_source.option_paperless_help">Uses text already extracted by Paperless-NGX (OCR). Fast and cost-effective.</small>
                        </label>
                    </div>

                    <div class="form-check mb-3">
                        <input class="form-check-input" type="radio" name="textSourceOption" id="textSourceOptionSmart" value="smart">
                        <label class="form-check-label" for="textSourceOptionSmart">
                            <strong data-i18n="text_source.option_smart">Extract text from PDF, use Vision API for images</strong>
                            <br>
                            <small class="text-muted" data-i18n="text_source.option_smart_help">Tries to extract text from PDF first. If not possible or an image, uses Vision API. Smart choice.</small>
                        </label>
                    </div>

                    <div class="form-check mb-3">
                        <input class="form-check-input" type="radio" name="textSourceOption" id="textSourceOptionVision" value="vision">
                        <label class="form-check-label" for="textSourceOptionVision">
                            <strong data-i18n="text_source.option_vision">Always send PDF to Vision API</strong>
                            <br>
                            <small class="text-muted" data-i18n="text_source.option_vision_help">Always sends document as image to Vision API for OCR. Best quality, higher cost.</small>
                        </label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-i18n="text_source.cancel">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="continueWithTextSource()" data-i18n="text_source.continue">Continue with Analysis</button>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/bootstrap.bundle.min.js"></script>
    <script src="/static/js/i18n.js"></script>
    <script src="/static/js/app.js"></script>
</body>
</html>
